# C4 Diagram

C4 diagrams model software architecture at multiple levels of abstraction using the C4 model
(Context, Container, Component, Code). Use them to document system boundaries, technology stacks,
and the relationships between people, systems, and components. Compatible with C4-PlantUML syntax.

```bnf
<diagram>           ::= <diagram-type> "\n" <statement>*

<diagram-type>      ::= "C4Context" | "C4Container" | "C4Component" | "C4Dynamic" | "C4Deployment"

<statement>         ::= "title " <string> "\n"
                      | <person>
                      | <system>
                      | <container>
                      | <component>
                      | <deployment-node>
                      | <boundary>
                      | <relationship>
                      | <style-update>
                      | <layout-config>

<!-- People -->

<person>            ::= ("Person" | "Person_Ext") "(" <alias> ", " '"' <label> '"' ["," '"' <descr> '"'] ")" "\n"

<!-- Systems -->

<system>            ::= <system-fn> "(" <alias> ", " '"' <label> '"' ["," '"' <descr> '"'] ")" "\n"
<system-fn>         ::= "System" | "System_Ext" | "SystemDb" | "SystemDb_Ext" | "SystemQueue" | "SystemQueue_Ext"

<!-- Containers -->

<container>         ::= <container-fn> "(" <alias> ", " '"' <label> '"' ["," '"' <techn> '"'] ["," '"' <descr> '"'] ")" "\n"
<container-fn>      ::= "Container" | "Container_Ext" | "ContainerDb" | "ContainerDb_Ext" | "ContainerQueue" | "ContainerQueue_Ext"

<!-- Components -->

<component>         ::= <component-fn> "(" <alias> ", " '"' <label> '"' ["," '"' <techn> '"'] ["," '"' <descr> '"'] ")" "\n"
<component-fn>      ::= "Component" | "Component_Ext" | "ComponentDb" | "ComponentDb_Ext" | "ComponentQueue" | "ComponentQueue_Ext"

<!-- Deployment -->

<deployment-node>   ::= ("Deployment_Node" | "Node" | "Node_L" | "Node_R") "(" <alias> ", " '"' <label> '"' ["," '"' <type> '"'] ["," '"' <descr> '"'] ") {" "\n" <statement>* "}" "\n"

<!-- Boundaries -->

<boundary>          ::= <boundary-fn> "(" <alias> ", " '"' <label> '"' ["," '"' <type> '"'] ") {" "\n" <statement>* "}" "\n"
<boundary-fn>       ::= "Boundary" | "Enterprise_Boundary" | "System_Boundary" | "Container_Boundary"

<!-- Relationships -->

<relationship>      ::= <rel-fn> "(" <alias> ", " <alias> ", " '"' <label> '"' ["," '"' <techn> '"'] ")" "\n"
<rel-fn>            ::= "Rel" | "BiRel" | "Rel_U" | "Rel_Up" | "Rel_D" | "Rel_Down" | "Rel_L" | "Rel_Left" | "Rel_R" | "Rel_Right" | "Rel_Back"

<!-- Dynamic diagram index -->

<rel-index>         ::= "RelIndex(" <index> ", " <alias> ", " <alias> ", " '"' <label> '"' ")" "\n"

<!-- Styling -->

<style-update>      ::= "UpdateElementStyle(" <alias> ["," <named-params>] ")" "\n"
                      | "UpdateRelStyle(" <alias> ", " <alias> ["," <named-params>] ")" "\n"
<named-params>      ::= <named-param> ("," <named-param>)*
<named-param>       ::= "$" <param-name> "=" '"' <value> '"'

<layout-config>     ::= "UpdateLayoutConfig(" <named-params> ")" "\n"

<alias>             ::= <identifier>
<identifier>        ::= [a-zA-Z_] [a-zA-Z0-9_]*
<string>            ::= (* any sequence of characters *)
```

## Diagram Types

| Literal        | Level         | Use for                                      |
| -------------- | ------------- | -------------------------------------------- |
| `C4Context`    | 1 - Context   | People and systems, their boundaries         |
| `C4Container`  | 2 - Container | Applications, data stores within a system    |
| `C4Component`  | 3 - Component | Internal components within a container       |
| `C4Dynamic`    | Dynamic       | Numbered interaction sequences               |
| `C4Deployment` | Deployment    | Infrastructure nodes and deployed containers |

## People

`Person` represents internal users; `Person_Ext` represents external users.

## Systems

| Function          | Use for                  |
| ----------------- | ------------------------ |
| `System`          | Internal system (box)    |
| `System_Ext`      | External system          |
| `SystemDb`        | Internal database system |
| `SystemDb_Ext`    | External database system |
| `SystemQueue`     | Internal queue system    |
| `SystemQueue_Ext` | External queue system    |

## Containers

Containers represent deployable units (applications, databases, queues) within a system. The `_Ext`
variants denote external containers. `ContainerDb` variants render as databases; `ContainerQueue`
variants render as queues.

## Components

Components represent internal modules within a container. Same naming pattern as containers with
`Component`, `ComponentDb`, `ComponentQueue` and their `_Ext` variants.

## Deployment Nodes

`Deployment_Node` (or shorthand `Node`) represents infrastructure nodes (servers, environments).
They can be nested to show hosting hierarchies.

## Boundaries

Boundaries visually group elements. `Enterprise_Boundary` for organizations, `System_Boundary` for
systems, `Container_Boundary` for containers, and generic `Boundary` for custom groupings.

## Relationships

| Function      | Use for                          |
| ------------- | -------------------------------- |
| `Rel`         | Unidirectional relationship      |
| `BiRel`       | Bidirectional relationship       |
| `Rel_U/Up`    | Relationship with upward hint    |
| `Rel_D/Down`  | Relationship with downward hint  |
| `Rel_L/Left`  | Relationship with leftward hint  |
| `Rel_R/Right` | Relationship with rightward hint |
| `Rel_Back`    | Return or backward relationship  |

Direction hints influence layout but are not guaranteed. Each relationship can include a technology
label.

## Style Updates

`UpdateElementStyle` overrides the visual style of a specific element. `UpdateRelStyle` overrides
relationship styling and can adjust label position with `$offsetX` and `$offsetY`.

Parameters use `$name="value"` syntax: `$fontColor`, `$bgColor`, `$borderColor`, `$textColor`,
`$lineColor`, `$offsetX`, `$offsetY`.

## Layout Configuration

`UpdateLayoutConfig` adjusts layout parameters:

| Parameter          | Use for                      | Default |
| ------------------ | ---------------------------- | ------- |
| `$c4ShapeInRow`    | Number of shapes per row     | `4`     |
| `$c4BoundaryInRow` | Number of boundaries per row | `2`     |
